<!DOCTYPE html>
<html lang="en">

<head>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style/homepage.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
   
</head>

<body>
    <div class="container">
        <div id="sidebar">
            <div id="title-bar">
                <h1 id="logo-title">PawPals</h1>
            </div>
            
            <div class="nav-buttons">
                <button class="navigator-buttons" onclick="goToHomepage()">Home</button>
                <button class="navigator-buttons" onclick="goToVetAI()">VetAI</button>
                <button class="navigator-buttons" onclick="goToMessages()">Messages</button>
                <button class="navigator-buttons" onclick="goToProfile()">Profile</button>
                <button class="navigator-buttons" onclick="goToSettings()">Settings</button>
            </div>
    
        </div>
    
        <div id="home-page" class="">
            <div id="top-bar">
                <div>
                    <h2 id="page-title">Home</h2>
                </div>
                <div id="right-section">
                    <button id="search-users">Search Users</button>
                    <button id="add-post" onclick="addPost()">+</button>
                </div>
            </div>
    
            <div id="feed">
                    <div class="post">
                        <div class="post-header">
                            <div class="header-left">
                                <img src="profile_pic.png" alt="Profile" class="profile-pic">
                                <h3 id="username-header">username1</h3>
                            </div>
                            <button class="location-btn" onclick="showLocation(this)">48.8584, 2.2945</button>
                        </div>
              
                        <div class="post-media">
                            <img src="cat.png" alt="Post media">
                        </div>
              
                        <div class="post-actions">
                            <button class="like-btn">‚ù§Ô∏è</button>
                        </div>
              
                        <div class="post-caption">
                            <span class="username">username1</span>
                            kitty cat üåû
                        </div>
                    </div>

                  <div class="post">
                    <div class="post-header">
                        <div class="header-left">
                            <img src="profile_pic.png" alt="Profile" class="profile-pic">
                            <h3 id="username-header">username2</h3>
                          </div>
                          <button class="location-btn" onclick="showLocation(this)">27.1751, 78.0421</button>
                    </div>
              
                    <div class="post-media">
                      <img src="dog.png" alt="Post media">
                    </div>
              
                    <div class="post-actions">
                      <button class="like-btn">‚ù§Ô∏è</button>
                    </div>
              
                    <div class="post-caption">
                      <span class="username">username2</span>
                      doggy dog üåû
                    </div>
                  </div>

                  <div class="post">
                    <div class="post-header">
                        <div class="header-left">
                            <img src="profile_pic.png" alt="Profile" class="profile-pic">
                            <h3 id="username-header">username3</h3>
                          </div>
                          <button class="location-btn" onclick="showLocation(this)">38.8977, 77.0365</button>
                    </div>
              
                    <div class="post-media">
                      <img src="fish.png" alt="Post media">
                    </div>
              
                    <div class="post-actions">
                      <button class="like-btn">‚ù§Ô∏è</button>
                    </div>
              
                    <div class="post-caption">
                      <span class="username">username3</span>
                      fishy fish üåû
                    </div>
                  </div>



            </div>
    
        </div>

        <div class="popup-overlay" id="popup-overlay">
            <div class="popup-content">
              <div id="map"></div>
            </div>
          </div>

        <div id="add-post-page" class="hidden">
            <div>
                <button id="back-button" onclick="backToHome()">‚Üê</button>
            </div>
            <div class="create-post">
                    <div class="upload-area" id="uploadArea">
                    +
                    <input type="file" id="fileInput" accept="image/*,video/*">
                  </div>
                <textarea class="caption-input" placeholder="Write a caption..."></textarea>
                <input type="text" id="location_entry" placeholder="Enter location (optional)">
                <button class="location-button" onclick="createPost()">Add post</button>
              </div>
        </div>
    </div>

    <script>
        function goToHomepage() {
            window.location.href = 'homepage.html'; 
        }

        function goToVetAI() {
            window.location.href = 'vetAI.html'; 
        }

        function goToMessages() {
            window.location.href = 'messages.html'; 
        }

        function goToProfile() {
            window.location.href = 'profilepage.html'; 
        }

        function goToSettings() {
            window.location.href = 'settings.html'; 
        }

        const homePage = document.getElementById("home-page");
        const addPostPage = document.getElementById("add-post-page");

        function backToHome(){
            homePage.classList.remove("hidden");
            addPostPage.classList.add("hidden");
        }

        function addPost(){
            homePage.classList.add("hidden");
            addPostPage.classList.remove("hidden");
        }

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;

        // Remove existing preview if any
        uploadArea.innerHTML = '';
        uploadArea.appendChild(fileInput);

        const fileURL = URL.createObjectURL(file);

        if (file.type.startsWith('image/')) {
            const img = document.createElement('img');
            img.src = fileURL;
            uploadArea.appendChild(img);
        } else if (file.type.startsWith('video/')) {
            const video = document.createElement('video');
            video.src = fileURL;
            video.controls = true;
            uploadArea.appendChild(video);
        }
        });

        function createPost(){
            const feed = document.getElementById("feed");
            const post = document.createElement("div");
            post.classList.add("post");

            const fileInput = document.getElementById("fileInput");
            const captionInput = document.querySelector(".caption-input");
            const file = fileInput.files[0];
            const captionText = captionInput.value.trim() || "";

            var location_entry = document.getElementById("location_entry");
            var locationInput = location_entry.value;
            locationInput = locationInput.replace(/ /g, "+");

            // Create media element
            let mediaHTML = "";

            if (file) {
                const fileURL = URL.createObjectURL(file);

                if (file.type.startsWith("image/")) {
                mediaHTML = `<img src="${fileURL}" alt="Post media">`;
                } else if (file.type.startsWith("video/")) {
                mediaHTML = `<video src="${fileURL}" controls></video>`;
                }
            } else {
                // Fallback image if no file was uploaded
                mediaHTML = `<img src="cat.png" alt="Post media">`;
            }

            if (locationInput){
                const url = `https://maps.googleapis.com/maps/api/geocode/json?address=${locationInput}&key=AIzaSyCG1kP9WiJeXDJegPwmpnAcH6ahbzj0M28`;
                //var locationOutput;
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.status === 'OK' && data.results.length > 0) {
                        var locationOutput = data.results[0].geometry.location;

                        post.innerHTML = `
                            <div class="post-header">
                                <div class="header-left">
                                    <img src="profile_pic.png" alt="Profile" class="profile-pic">
                                    <h3 id="username-header">username1</h3>
                                </div>
                                <button class="location-btn" onclick="showLocation(this)">${locationOutput.lat}, ${locationOutput.lng}</button>
                            </div>
                    
                            <div class="post-media">
                                ${mediaHTML}
                            </div>
                    
                            <div class="post-actions">
                                <button class="like-btn">‚ù§Ô∏è</button>
                            </div>
                    
                            <div class="post-caption">
                                <span class="username">username1</span>
                                ${captionText}
                            </div>
                        `    
                        ;
                    } else {
                        console.error(`Geocoding failed. Status: ${data.status}`);
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching coordinates:", error);
                    });
            }else{
                post.innerHTML = `
                <div class="post-header">
                    <div class="header-left">
                        <img src="profile_pic.png" alt="Profile" class="profile-pic">
                        <h3 id="username-header">username1</h3>
                    </div>
                    <button class="location-btn" onclick="showLocation(this)">32.7310, -97.1150</button>
                </div>
        
                <div class="post-media">
                    ${mediaHTML}
                </div>
        
                <div class="post-actions">
                    <button class="like-btn">‚ù§Ô∏è</button>
                </div>
        
                <div class="post-caption">
                    <span class="username">username1</span>
                    ${captionText}
                </div>
            `    
            ;
            }

            feed.appendChild(post);

            fileInput.value = "";
            captionInput.value = "";
            const uploadArea = document.getElementById("uploadArea");
            uploadArea.innerHTML = "+";
            uploadArea.appendChild(fileInput);

            backToHome();
        }
    
        
        
        const popupOverlay = document.getElementById('popup-overlay');

        var map = L.map('map').setView([32.7310, -97.1150], 20);
        L.tileLayer('https://api.maptiler.com/maps/base-v4/{z}/{x}/{y}.png?key=24wki6qF8iMB4OiU1zOY', {
        attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        }).addTo(map);
        var marker = L.marker([32.7310, -97.1150]).addTo(map);

        function showLocation(btn){
            
            const coordsText = btn.innerHTML;

            const parts = coordsText.split(',');
            const lat = parseFloat(parts[0].trim());
            const lng = parseFloat(parts[1].trim());


            map.setView([lat,lng], 20); 
            marker.setLatLng([lat,lng]);
            
            popupOverlay.classList.add('active');
        }

        popupOverlay.addEventListener('click', (event) => {
            if (event.target === popupOverlay) {
                popupOverlay.classList.remove('active');
            }
        });
    </script>

</body>
